---

- name: Server initialization
  hosts:
    - "{{ target | default('vpn') }}"
  vars_files:
    - vars.yml
  vars_prompt:
    - name: ansible_become_pass
      prompt: "Enter the {{ admin_username }} user password"
      private: yes
      unsafe: yes
  become: yes
  become_user: root
  become_method: sudo
  remote_user: "{{ admin_username }}"
  roles:
    - role: init
      tags: [ init ]

    - role: sshd
      tags: [ security, sshd ]
    - role: wireguard
      tags: [ security, wireguard ]
    - role: nftables
      tags: [ security, nftables ]

    - role: unbound
      tags: [ services, unbound ]
    - role: nginx
      tags: [ services, nginx ]
    - role: tls
      tags: [ services, tls ]
    - role: website
      tags: [ services, website ]
    - role: git
      tags: [ services, git ]
    - role: rsync
      tags: [ services, rsync ]
    - role: rss
      tags: [ services, rss ]
